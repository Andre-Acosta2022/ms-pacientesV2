# -------------------------------
# CONFIGURACIÓN GENERAL DE SPRING
# -------------------------------

# Permite que un bean pueda ser redefinido en el contexto de Spring (útil para reemplazos)
spring.main.allow-bean-definition-overriding=true

# Nombre de la aplicación (registrado en Eureka)
spring.application.name=ms-pacientes

# Puerto en el que se ejecuta el microservicio
server.port=8086

# -------------------------------
# SEGURIDAD - OAuth2 / JWT
# -------------------------------

# Configuración del servidor OAuth2 para validar tokens JWT (URL del issuer del realm)
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8088/realms/your-realm/protocol/openid-connect/certs

# -------------------------------
# RESILIENCE4J - CIRCUIT BREAKER
# -------------------------------

# Configuración general de circuit breaker con Resilience4j
# Tamaño de la ventana deslizante para cálculo de errores
resilience4j.circuitbreaker.configs.default.slidingWindowSize=10
# Porcentaje de fallos para abrir el circuito (en %)
resilience4j.circuitbreaker.configs.default.failureRateThreshold=50
# Tiempo que el circuito se mantiene abierto (en milisegundos)
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=60000
# Número permitido de llamadas en estado half-open (prueba)
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3
# Mínimo número de llamadas para empezar a evaluar tasa de fallo
resilience4j.circuitbreaker.configs.default.minimumNumberOfCalls=5

# Instancias específicas del circuit breaker usando la configuración default
resilience4j.circuitbreaker.instances.citaService.baseConfig=default
resilience4j.circuitbreaker.instances.hcService.baseConfig=default
resilience4j.circuitbreaker.instances.facturaService.baseConfig=default

# -------------------------------
# BASE DE DATOS - MySQL / JPA / Hibernate
# -------------------------------

# Configuración de la conexión a la base de datos MySQL
spring.datasource.url=jdbc:mysql://localhost:3306/ms_pacientes
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Desactiva Open-in-view para evitar problemas con sesiones de Hibernate
spring.jpa.open-in-view=false

# Configuración de Hibernate para actualizar automáticamente el esquema
spring.jpa.hibernate.ddl-auto=update

# Formatea el SQL para facilitar la lectura en logs
spring.jpa.properties.hibernate.format_sql=true

# -------------------------------
# CONFIGURACIÓN CLOUD
# -------------------------------

# Desactiva el cliente Spring Cloud Config (no usar configuración centralizada)
spring.cloud.config.enabled=false

# -------------------------------
# EUREKA CLIENT
# -------------------------------

# URL del servidor Eureka para registrar y obtener servicios
eureka.client.service-url.defaultZone=http://eureka-server:8761/eureka/
# Indica que este servicio se registra en Eureka
eureka.client.register-with-eureka=true
# Indica que este servicio puede obtener el registro de Eureka
eureka.client.fetch-registry=true
# Preferir registrar la IP en lugar del hostname en Eureka
eureka.instance.prefer-ip-address=true

# -------------------------------
# FEIGN CLIENT (CLIENTE REST)
# -------------------------------

# Tiempo máximo para conectar con otros servicios (ms)
feign.client.config.default.connectTimeout=5000
# Tiempo máximo para leer respuesta de otros servicios (ms)
feign.client.config.default.readTimeout=5000
